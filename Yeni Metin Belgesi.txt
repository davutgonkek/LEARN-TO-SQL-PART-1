-- database oluşturma
CREATE DATABASE Deneme

--tablo oluşturma
CREATE TABLE KitapBilgi
(AD VARCHAR(50),YAZAR VARCHAR(50), SAYFA VARCHAR(4), STOK smallint)

--tablo çağırma
SELECT * FROM KitapBilgi

-- 1er artan id li tablo oluşturma
CREATE TABLE Tablo1
(ID int identity(1,1), AD VARCHAR(20))

-- doğumyeri için değer girilmediyse varsayılan olarak adana gir
CREATE TABLE Tablo2
(ID int identity(1,1), AD VARCHAR(20), DOGUMYERİ VARCHAR(20) DEFAULT 'ADANA')

-- tabloda değişiklik yapmak istiyorsak
ALTER TABLE Tablo1
ADD SOYAD VARCHAR(50)
SELECT * FROM  Tablo1

-- tabloda veri türünde değişiklik yapmak istiyorsak
ALTER TABLE Tablo1
ALTER COLUMN SOYAD VARCHAR(100)
SELECT * FROM  Tablo1

-- TABLO SİLMEK İÇİN
DROP TABLE Tablo2

--TABLODA SİLME İŞLEMİ
ALTER TABLE KitapBilgi
DROP COLUMN STOK
SELECT * FROM KitapBilgi



SELECT * FROM CUSTOMERS

--tabloda istediğimiz sütunları görmek
SELECT ID,CUSTOMERNAME,CITY FROM CUSTOMERS

--tabloda filtreleme
SELECT * FROM CUSTOMERS WHERE GENDER='E'

--and kullanımı
SELECT * FROM CUSTOMERS WHERE GENDER='E' AND CITY='iSTANBUL'

-- or kullanımı
SELECT ID, CUSTOMERNAME, CITY, GENDER, AGE FROM CUSTOMERS WHERE GENDER='E' OR AGE> 50

-- tabloya değer girmek için
INSERT INTO CUSTOMERS (CUSTOMERNAME, CITY, BIRTHDATE, DISTRICT, GENDER, NATION, AGE)
VALUES ('Davut', 'Batman', '1997-10-24', 'Karşıyaka', 'E', 'TR',20)

--değer silmek için
DELETE FROM CUSTOMERS WHERE CUSTOMERNAME='Davut'

-- tabloda güncelleme için istanbul verilerini İSTANBUL olarak güncelledik
UPDATE CUSTOMERS SET CITY='iSTANBUL' WHERE CITY='istanbul' 

-- TABLOYA VERİ GİRMEK
CREATE TABLE DENEME2
(ID INT IDENTITY(1,1), AD VARCHAR(20), DEPARTMAN VARCHAR(20), MAAS DECIMAL(18,2), DURUM BIT,SEHIR VARCHAR(20) DEFAULT 'DENİZLİ')

INSERT INTO DENEME2(AD, DEPARTMAN, MAAS, DURUM)
VALUES ('BurakDEGS', 'ITC', 15000,1)
INSERT INTO DENEME2(AD, DEPARTMAN, MAAS, DURUM)
VALUES ('BurakD', 'ICST', 15000,1)
INSERT INTO DENEME2(AD, DEPARTMAN, MAAS, DURUM)
VALUES ('BurakG', 'ITC', 15000,1)
INSERT INTO DENEME2(AD, DEPARTMAN, MAAS, DURUM)
VALUES ('BurakDG', 'IST', 15000,1)



------------------------------------------------------------------------------------------------------------------

-- Kullanıcı adı Ad soyad il İlçe Semt Açık Adre
--Sipariş Id Tarih Toplam Tutar Ödeme Tarihi
--Banka Onay Kodu FAtura Tarihi Kargo Fiş No

SELECT 
	U.USERNAME_ AS KULLANICIADI, U.NAMESURNAME AS ADSOYAD,
	CT.CITY IL, T.TOWN AS ILCE, D.DISTRICT AS SEMT, A.ADDRESSTEXT AS ACIKADRES,
	O.ID AS SIPARISID, O.DATE_ AS TARIH, O.TOTALPRICE AS TOPLAMTUTAR,
	P.DATE_ AS ODEMETARIHI, P.APPROVECODE AS BANKAONAYKODU,
	I.DATE_ AS FATURATARIHI, I.CARGOFICHENO AS KARGOFISHNO

FROM ORDERS  O
	INNER JOIN USERS U ON U.ID=O.USERID
	INNER JOIN ADDRESS A ON A.ID=O.ADDRESSID
	INNER JOIN CITIES CT ON CT.ID=A.CITYID
	INNER JOIN TOWNS T ON T.ID=A.TOWNID
	INNER JOIN DISTRICTS D ON D.ID=A.DISTRICTID
	INNER JOIN PAYMENTS P ON P.ORDERID=O.ID
	INNER JOIN INVOICES I ON I.ORDERID=O.ID

	
WHERE U.NAMESURNAME='Canan ERDİŞ'


--şehirlerre göre toplam sipariş
SELECT
CT.CITY AS SEHIRADI,
SUM(OD.LINETOTAL) AS TOPLAMSIPARIS_TUTARI,
SUM(OD.AMOUNT) AS TOPLAMSIPARIS_ADEDI,
COUNT(OD.ID) AS TOPLAMSIPARIS_SAYIS
 
 FROM ORDERS  O
	INNER JOIN USERS U ON U.ID=O.USERID
	INNER JOIN ADDRESS A ON A.ID=O.ADDRESSID
	INNER JOIN CITIES CT ON CT.ID=A.CITYID
	INNER JOIN TOWNS T ON T.ID=A.TOWNID
	INNER JOIN DISTRICTS D ON D.ID=A.DISTRICTID
	INNER JOIN PAYMENTS P ON P.ORDERID=O.ID
	INNER JOIN INVOICES I ON I.ORDERID=O.ID
	INNER JOIN ORDERDETAILS OD ON OD.ORDERID=O.ID
	INNER JOIN ITEMS ITM ON ITM.ID=OD.ITEMID


GROUP BY CT.CITY 
ORDER BY CT.CITY

 


--KATEGORİLERE GÖRE ANALİZ
SELECT
ITM.CATEGORY1,
SUM(OD.LINETOTAL) AS TOPLAMSIPARIS_TUTARI,
SUM(OD.AMOUNT) AS TOPLAMSIPARIS_ADEDI,
COUNT(OD.ID) AS TOPLAMSIPARIS_SAYIS
 
 FROM ORDERS  O
	INNER JOIN USERS U ON U.ID=O.USERID
	INNER JOIN ADDRESS A ON A.ID=O.ADDRESSID
	INNER JOIN CITIES CT ON CT.ID=A.CITYID
	INNER JOIN TOWNS T ON T.ID=A.TOWNID
	INNER JOIN DISTRICTS D ON D.ID=A.DISTRICTID
	INNER JOIN PAYMENTS P ON P.ORDERID=O.ID
	INNER JOIN INVOICES I ON I.ORDERID=O.ID
	INNER JOIN ORDERDETAILS OD ON OD.ORDERID=O.ID
	INNER JOIN ITEMS ITM ON ITM.ID=OD.ITEMID


GROUP BY ITM.CATEGORY1 
ORDER BY 2 DESC

-- ÜRÜNLERİN FİYAT ANALİZİ
SELECT ITM.ITEMCODE AS URUNKODU,
ITM.ITEMNAME AS URUNADI,
(SELECT MIN(UNITPRICE) FROM ORDERDETAILS WHERE ITEMID=ITM.ID) AS ENDUSUKFIYAT
FROM

ITEMS ITM
ORDER BY ITM.ITEMNAME












